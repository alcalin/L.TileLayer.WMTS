{"version":3,"file":"leaflet.tilelayer.wmts.umd.js","sources":["../src/leaflet.tilelayer.wmts.js"],"sourcesContent":["import * as L from \"leaflet\";\n\nexport class WMTS extends L.TileLayer {\n  constructor(url, options = {}) {\n    super(url, options);\n\n    const {\n      layer, tileMatrixSet, style = \"default\", format = \"image/png\",\n      time, tileMatrixLabels, googleMapsCompatible = true,\n      extraParams, baseQuery, crossOrigin, requestEncoding, ...tileLayerOpts\n    } = options;\n\n    if (!layer) throw new Error(\"WMTS: 'layer' is required.\");\n    if (!tileMatrixSet) throw new Error(\"WMTS: 'tileMatrixSet' is required.\");\n\n    L.setOptions(this, tileLayerOpts);\n\n    this._labels = tileMatrixLabels;\n    this._gmc = googleMapsCompatible === true;\n\n    // Normalize encoding; detect from URL tokens if unspecified.\n    const enc = String(requestEncoding ?? \"\").toUpperCase();\n    const urlHasRestTokens = /\\{(layer|style|time|tilematrixset|tilematrix|z|x|y)\\}/i.test(url);\n    this._encoding = enc === \"RESTFUL\" ? \"REST\" : enc;\n    if (this._encoding !== \"REST\" && this._encoding !== \"KVP\") {\n      this._encoding = urlHasRestTokens ? \"REST\" : \"KVP\";\n    }\n\n    this._baseUrl = baseQuery && baseQuery.length\n      ? `${url}${url.includes(\"?\") ? \"&\" : \"?\"}${baseQuery}`\n      : url;\n\n    const size = this.getTileSize();\n    this._wmtsParams = {\n      SERVICE: \"WMTS\",\n      REQUEST: \"GetTile\",\n      VERSION: \"1.0.0\",\n      LAYER: String(layer),\n      STYLE: String(style),\n      TILEMATRIXSET: String(tileMatrixSet),\n      FORMAT: String(format),\n      WIDTH: String(size.x),\n      HEIGHT: String(size.y)\n    };\n\n    if (extraParams) {\n      for (const [k, v] of Object.entries(extraParams)) {\n        this._wmtsParams[k.toUpperCase()] = String(v);\n      }\n    }\n\n    this._rest = {\n      layer: String(layer),\n      style: String(style),\n      time: time ? String(time) : undefined,\n      tileMatrixSet: String(tileMatrixSet)\n    };\n\n    if (crossOrigin !== undefined) {\n      this.options.crossOrigin = crossOrigin === true ? \"\" : crossOrigin;\n    }\n  }\n\n  createTile(coords, done) {\n    const tile = super.createTile(coords, done);\n    if (this.options.crossOrigin && !tile.crossOrigin) {\n      tile.crossOrigin = this.options.crossOrigin;\n    }\n    return tile;\n  }\n\n  getTileUrl(coords) {\n    const z = this._tileZoom;\n    const matrix = this._labels && this._labels[z] !== undefined ? this._labels[z] : z;\n\n    if (!this._gmc && !this._labels) {\n      throw new Error(\"WMTS: Non-GoogleMapsCompatible grids require tileMatrixLabels mapping.\");\n    }\n\n    // REST branch: expand ALL placeholders in one go (incl. {s})\n    if (this._encoding === \"REST\") {\n      const ctx = {\n        s: this._getSubdomain(coords),\n        layer: this._rest.layer,\n        style: this._rest.style,\n        time: this._rest.time,\n        tilematrixset: this._rest.tileMatrixSet,\n        tileMatrixSet: this._rest.tileMatrixSet, // camelCase too, if template uses it\n        z, x: coords.x, y: coords.y,\n        tilematrix: String(matrix),\n        tileMatrix: String(matrix)\n      };\n      return L.Util.template(this._baseUrl, ctx);\n    }\n\n    // KVP branch: URL must NOT contain REST placeholders besides optional {s}\n    const hasNonSubdomainTokens = /\\{(?!s\\})[^}]+\\}/.test(this._baseUrl);\n    if (hasNonSubdomainTokens) {\n      throw new Error(\"WMTS KVP: base URL contains REST placeholders. Use REST encoding or a KVP base.\");\n    }\n\n    const url = L.Util.template(this._baseUrl, { s: this._getSubdomain(coords) });\n    const params = {\n      ...this._wmtsParams,\n      TILEMATRIX: String(matrix),\n      TILEROW: String(coords.y),\n      TILECOL: String(coords.x)\n    };\n    return url + L.Util.getParamString(params, url);\n  }\n\n  setParams(params = {}, noRedraw) {\n    if (params.requestEncoding) {\n      const enc = String(params.requestEncoding).toUpperCase();\n      this._encoding = enc === \"RESTFUL\" ? \"REST\" : enc;\n    }\n\n    if (params.layer) {\n      this._wmtsParams.LAYER = String(params.layer);\n      this._rest.layer = String(params.layer);\n    }\n    if (params.style) {\n      this._wmtsParams.STYLE = String(params.style);\n      this._rest.style = String(params.style);\n    }\n    if (params.tileMatrixSet) {\n      this._wmtsParams.TILEMATRIXSET = String(params.tileMatrixSet);\n      this._rest.tileMatrixSet = String(params.tileMatrixSet);\n    }\n    if (params.format) this._wmtsParams.FORMAT = String(params.format);\n    if (params.time !== undefined) this._rest.time = params.time ? String(params.time) : undefined;\n\n    if (params.tileMatrixLabels) this._labels = params.tileMatrixLabels;\n    if (typeof params.googleMapsCompatible === \"boolean\") this._gmc = params.googleMapsCompatible;\n\n    if (params.extraParams) {\n      for (const [k, v] of Object.entries(params.extraParams)) {\n        this._wmtsParams[k.toUpperCase()] = String(v);\n      }\n    }\n\n    if (params.baseQuery !== undefined) {\n      const sep = this._url.includes(\"?\") ? \"&\" : \"?\";\n      this._baseUrl = `${this._url}${sep}${params.baseQuery ?? \"\"}`;\n    }\n\n    if (!noRedraw) this.redraw();\n    return this;\n  }\n}\n\nexport function wmts(url, options) {\n  return new WMTS(url, options);\n}"],"names":["L"],"mappings":"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"}