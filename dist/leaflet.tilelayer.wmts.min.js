!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("leaflet")):"function"==typeof define&&define.amd?define(["exports","leaflet"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).LTileLayerWMTS={},t.L)}(this,function(t,e){"use strict";function i(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(i){if("default"!==i){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})}}),e.default=t,Object.freeze(e)}var r=i(e);class s extends r.TileLayer{constructor(t,e={}){super(t,e);const{layer:i,tileMatrixSet:s,style:a="default",format:n="image/png",time:l,tileMatrixLabels:o,googleMapsCompatible:g=!0,extraParams:S,baseQuery:h,crossOrigin:c,requestEncoding:m,...f}=e;if(!i)throw new Error("WMTS: 'layer' is required.");if(!s)throw new Error("WMTS: 'tileMatrixSet' is required.");r.setOptions(this,f),this._labels=o,this._gmc=!0===g;const _=String(m??"").toUpperCase(),u=/\{(layer|style|time|tilematrixset|tilematrix|z|x|y)\}/i.test(t);this._encoding="RESTFUL"===_?"REST":_,"REST"!==this._encoding&&"KVP"!==this._encoding&&(this._encoding=u?"REST":"KVP"),this._baseUrl=h&&h.length?`${t}${t.includes("?")?"&":"?"}${h}`:t;const T=this.getTileSize();if(this._wmtsParams={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:"1.0.0",LAYER:String(i),STYLE:String(a),TILEMATRIXSET:String(s),FORMAT:String(n),WIDTH:String(T.x),HEIGHT:String(T.y)},S)for(const[t,e]of Object.entries(S))this._wmtsParams[t.toUpperCase()]=String(e);this._rest={layer:String(i),style:String(a),time:l?String(l):void 0,tileMatrixSet:String(s)},void 0!==c&&(this.options.crossOrigin=!0===c?"":c)}createTile(t,e){const i=super.createTile(t,e);return this.options.crossOrigin&&!i.crossOrigin&&(i.crossOrigin=this.options.crossOrigin),i}getTileUrl(t){const e=this._tileZoom,i=this._labels&&void 0!==this._labels[e]?this._labels[e]:e;if(!this._gmc&&!this._labels)throw new Error("WMTS: Non-GoogleMapsCompatible grids require tileMatrixLabels mapping.");if("REST"===this._encoding){const s={s:this._getSubdomain(t),layer:this._rest.layer,style:this._rest.style,time:this._rest.time,tilematrixset:this._rest.tileMatrixSet,tileMatrixSet:this._rest.tileMatrixSet,z:e,x:t.x,y:t.y,tilematrix:String(i),tileMatrix:String(i)};return r.Util.template(this._baseUrl,s)}if(/\{(?!s\})[^}]+\}/.test(this._baseUrl))throw new Error("WMTS KVP: base URL contains REST placeholders. Use REST encoding or a KVP base.");const s=r.Util.template(this._baseUrl,{s:this._getSubdomain(t)}),a={...this._wmtsParams,TILEMATRIX:String(i),TILEROW:String(t.y),TILECOL:String(t.x)};return s+r.Util.getParamString(a,s)}setParams(t={},e){if(t.requestEncoding){const e=String(t.requestEncoding).toUpperCase();this._encoding="RESTFUL"===e?"REST":e}if(t.layer&&(this._wmtsParams.LAYER=String(t.layer),this._rest.layer=String(t.layer)),t.style&&(this._wmtsParams.STYLE=String(t.style),this._rest.style=String(t.style)),t.tileMatrixSet&&(this._wmtsParams.TILEMATRIXSET=String(t.tileMatrixSet),this._rest.tileMatrixSet=String(t.tileMatrixSet)),t.format&&(this._wmtsParams.FORMAT=String(t.format)),void 0!==t.time&&(this._rest.time=t.time?String(t.time):void 0),t.tileMatrixLabels&&(this._labels=t.tileMatrixLabels),"boolean"==typeof t.googleMapsCompatible&&(this._gmc=t.googleMapsCompatible),t.extraParams)for(const[e,i]of Object.entries(t.extraParams))this._wmtsParams[e.toUpperCase()]=String(i);if(void 0!==t.baseQuery){const e=this._url.includes("?")?"&":"?";this._baseUrl=`${this._url}${e}${t.baseQuery??""}`}return e||this.redraw(),this}}t.WMTS=s,t.wmts=function(t,e){return new s(t,e)}});